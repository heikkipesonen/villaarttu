"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function renderImageFeedItem(t){return'\n    <div class="image-feed-item col-xs-12 col-md-4 col-lg-3">\n      <a href="'+t.link+'" target="_blank">\n        <figure class="image-container" style="background-image: url(\''+t.images.standard_resolution.url+"')\"></figure>\n      </a>\n    </div>\n    "}function sliderNext(){slider.next()}function sliderPrev(){slider.prev()}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Slider=function(){function t(e){var i=this;_classCallCheck(this,t),this.options=e,this._state={dragStarted:!1,x:0,y:0,deltax:0,deltay:0,animation:0,dirty:!1},this.lastEvent=!1,this.timer=!1,this.indicators=[],this.slides=[document.createElement("div"),document.createElement("div"),document.createElement("div")],this.container=document.querySelector(e.element),this.slideContainer=document.createElement("div"),this.slideIndicatorContainer=document.createElement("div"),this.slideContainer.classList.add("slide-container"),this.slideIndicatorContainer.classList.add("slide-indicator-container"),this.slides.forEach(function(t){t.classList.add("slide"),i.slideContainer.appendChild(t)}),this.container.appendChild(this.slideContainer),this.container.appendChild(this.slideIndicatorContainer),this.viewWidth=0,document.addEventListener("mouseup",function(t){return i.endDrag(t)}),document.addEventListener("mousemove",function(t){return i.onDrag(t)}),this.container.addEventListener("mousedown",function(t){return i.startDrag(t)}),this.container.addEventListener("touchstart",function(t){return i.startDrag(t)}),this.container.addEventListener("touchmove",function(t){return i.onDrag(t)}),this.container.addEventListener("touchend",function(t){return i.endDrag(t)}),document.addEventListener("keyup",function(t){39===t.keyCode?i.next():37===t.keyCode&&i.prev()}),window.addEventListener("resize",function(){i.resizeSlides(),i.center=1}),this.resizeSlides(),this.buildIndicators(),this.update(),this.setTimer(),this.current=e.slides[0].id,this.center=1}return _createClass(t,[{key:"resetPosition",value:function(){var t=this;this.center=1,this.state={animation:this.options.animation||300},setTimeout(function(){t.state={animation:0}},this.options.animation||300)}},{key:"next",value:function(){var t=this;this.center=2,this.state={animation:this.options.animation||300},setTimeout(function(){var e=t.slides.shift();t.slides.push(e),t.center=1,t.current=t.currentSlide.next,t.reflow(),t.state={animation:0},t.setTimer()},this.options.animation||300)}},{key:"prev",value:function(){var t=this;this.center=0,this.state={animation:this.options.animation||300},setTimeout(function(){var e=t.slides.pop();t.slides.unshift(e),t.center=1,t.current=t.currentSlide.prev,t.reflow(),t.state={animation:0},t.setTimer()},this.options.animation||300)}},{key:"getSlide",value:function(t){return this.options.slides.find(function(e){return e.id===t})||{content:""}}},{key:"buildIndicators",value:function(){var t=this;this.indicators.length=0,this.options.slides.forEach(function(){var e=document.createElement("div");e.classList.add("slide-indicator"),t.indicators.push(e),t.slideIndicatorContainer.appendChild(e)})}},{key:"resizeSlides",value:function(){var t=this;this.viewWidth=this.container.offsetWidth,this.slides.forEach(function(e,i){e.style.width=t.viewWidth+"px"}),this.slideContainer.style.width=3*this.viewWidth+"px",this.reflow()}},{key:"reflow",value:function(){var t=this;this.slides.forEach(function(e,i){e.style.left=t.viewWidth*i+"px"})}},{key:"getPointer",value:function(t){var e={};return e=t.touches&&t.touches.length?{x:t.touches[0].pageX,y:t.touches[0].pageY,timeStamp:t.timeStamp}:{x:t.pageX,y:t.pageY,timeStamp:t.timeStamp},this.lastEvent&&(e.vx=(e.x-this.lastEvent.x)/(e.timeStamp-this.lastEvent.timeStamp),e.vy=(e.y-this.lastEvent.y)/(e.timeStamp-this.lastEvent.timeStamp)),e}},{key:"clearTimer",value:function(){this.timer&&clearTimeout(this.timer)}},{key:"setTimer",value:function(){var t=this;this.clearTimer(),this.options.interval&&(this.timer=setTimeout(function(){t.next()},this.options.interval))}},{key:"update",value:function(){var t=this;this.state.dirty&&(this.slideContainer.style.transform="translate3d("+-this.state.x+"px, 0, 0)",this.slideContainer.style["-webkit-transform"]="translate3d("+-this.state.x+"px, 0, 0)",this.slideContainer.style["-ms-transform"]="translate3d("+-this.state.x+"px, 0, 0)",this.slideContainer.style["-o-transform"]="translate3d("+-this.state.x+"px, 0, 0)",this.slideContainer.style["transition-duration"]=this.state.animation+"ms",this._state.dirty=!1),window.requestAnimationFrame(function(){return t.update()})}},{key:"startDrag",value:function(t){this.state.dragStarted=!0,this.lastEvent=this.getPointer(t),this.clearTimer()}},{key:"onDrag",value:function(t){if(this.state.dragStarted){var e=this.getPointer(t),i=this.lastEvent.x-e.x,n=this.lastEvent.y-e.y;Math.abs(i)>10&&(t.stopPropagation(),t.preventDefault()),Math.abs(n)>10||(this.state={x:this.state.x+i,y:this.state.x+n,deltax:this.state.deltax+i,deltay:this.state.deltay+n},this.lastEvent=this.getPointer(t))}}},{key:"endDrag",value:function(){this.state.dragStarted=!1,this.offset>.3||this.lastEvent.vx<-.3&&Math.abs(this.state.deltax)>10?this.next():this.offset<-.3||this.lastEvent.vx>.3&&Math.abs(this.state.deltax)>10?this.prev():this.resetPosition(),this.setTimer(),this.state={deltax:0,deltay:0}}},{key:"current",set:function(t){this.currentSlide=this.getSlide(t);var e=this.options.slides.indexOf(this.currentSlide);this.indicators.forEach(function(t){return t.classList.remove("selected")}),this.indicators[e].classList.add("selected"),this.slides[1].innerHTML!==this.currentSlide.content&&(this.slides[1].innerHTML=this.currentSlide.content),this.slides[2].innerHTML!==this.getSlide(this.currentSlide.next).content&&(this.slides[2].innerHTML=this.getSlide(this.currentSlide.next).content),this.slides[0].innerHTML!==this.getSlide(this.currentSlide.prev).content&&(this.slides[0].innerHTML=this.getSlide(this.currentSlide.prev).content)}},{key:"center",set:function(t){this.state={x:this.viewWidth*t}}},{key:"distToCenter",get:function(){return this.state.x-this.viewWidth}},{key:"offset",get:function(){return(this.state.x-this.viewWidth)/this.viewWidth}},{key:"state",get:function(){return this._state},set:function(t){var e=this;Object.keys(t).forEach(function(i){e._state[i]!==t[i]&&(e._state[i]=t[i],e._state.dirty=!0)})}}]),t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),prefixes=["moz","o","ms","webkit"],ParallaxScroller=function(){function t(e){var i=this;_classCallCheck(this,t),this.container=window,this.scrollContent=document.body,this.layers=e,this.maxScroll=0,this.scrollContainer=document.createElement("div"),this.scrollContainer.classList.add("parallax-wrapper"),this.scrollContent.insertBefore(this.scrollContainer,this.scrollContent.firstChild),this._layers=this.layers.map(function(t){return i.loadLayer(t)}),this.container.addEventListener("scroll",function(){return i.applyScroll()}),window.addEventListener("resize",function(){return i.resize()}),this.resize()}return _createClass(t,[{key:"loadLayer",value:function(t){var e=this,i=new Image,n={el:document.createElement("div"),layer:t,img:i,movementRatio:0};return n.el.classList.add("parallax-layer"),this.scrollContainer.appendChild(n.el),i.onload=function(){n.el.style["background-image"]="url("+i.src+")",e.resize()},i.src=t.image,n}},{key:"resize",value:function(){var t=this;this.scrollContainer.style.height=this.scrollContent.offsetHeight+"px",this.scrollContainer.style.width=this.scrollContent.offsetWidth+"px";this.container.innerHeight;this.maxScroll=this.scrollContent.scrollHeight-this.container.innerHeight,this._layers.forEach(function(e){e.movementRatio=e.el.offsetHeight/t.scrollContent.scrollHeight}),this.applyScroll()}},{key:"applyScroll",value:function(){var t=this;this._layers.map(function(e){var i=-t.container.scrollY*e.movementRatio;prefixes.forEach(function(t){e.el.style["-"+t+"-transform"]="translate3d(0, "+i+"px, 0)"}),e.el.style.transform="translate3d(0, "+i+"px, 0)"})}}]),t}(),sliderOptions={element:"#slider",animation:300,interval:5e3,slides:Array(12).fill(!1).map(function(t,e){var i=e+1;return{id:e,content:'<div class="slide-image" style="background-image: url(\'images/'+i+".jpg')\"></div>",next:i>11?0:i,prev:i-2<0?11:i-2}})},parallaxLayers=[{image:"images/villa-arttu-web-palikka1.png"},{image:"images/villa-arttu-web-palikka2.png"}],slider=new Slider(sliderOptions),scroll=new ParallaxScroller(parallaxLayers),apiUrl="data.json",container=document.getElementById("image-feed");container.classList.add("api-loading"),fetch(apiUrl).then(function(t){t.json().then(function(t){container.classList.remove("api-loading");var e=t.items.map(renderImageFeedItem).join("");container.innerHTML=e,window.dispatchEvent(new Event("resize"))})});